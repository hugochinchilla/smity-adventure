pico-8 cartridge // http://www.pico-8.com
version 35
__lua__

left,right,up,down,fire1,fire2=0,1,2,3,4,5
black,dark_blue,dark_purple,dark_green,brown,dark_gray,light_gray,white,red,orange,yellow,green,blue,indigo,pink,peach=0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
non_walkable = 0


function _init()
    t = 0
    dog_setup()
    human_setup()
    ball_setup()
end

function _update()
    t += 1
    move_dog()
end

function _draw()
    cls()
    draw_map()
    draw_human()
    draw_ball()
    draw_dog()
end

-->8
-- Rendering tools
function anim_frame(anim)
    _t = flr(t/6)
    return anim[_t%#anim+1]
end

function draw_map()
    map(0,0,0,0,32,32)
end

function cel(pos)
    return flr(pos/8)
end

function is_tile(type, x, y)
    tile = mget(cel(x), cel(y))
    return fget(tile, type)
end

-->8
-- Player
function dog_setup()
    dog = {}
    dog.x = 64
    dog.y = 64
    dog.box = {8,8}
    dog.face_left = true
    dog.anim = {48,49,50,51}
    dog.msg = {t=0, txt=""}
    dog.love = false
end

function human_setup()
    human = {}
    human.x = 50
    human.y = 55
    human.box = {8,8}
end

function ball_setup()
    ball = {}
    ball.x = 90
    ball.y = 60
end

function draw_dog()
    pal(7,0)
    spr(anim_frame(dog.anim),dog.x,dog.y,1.0,1.0,not dog.face_left)
    if (dog.msg.t > 0) then
        dog.msg.t -= 1
        print(dog.msg.txt, dog.x-3, dog.y-6, black)
    end
    if (dog.love and dog.msg.t == 0) then
        print("â™¥", dog.x, dog.y-6, red)
    end
    pal()
    draw_object_box(dog, red)
end

function draw_human()
    spr(16, human.x, human.y)
    draw_object_box(human, blue)

    --d = ldistance(dog, human)
    --x,y = unpack(distance(dog, human))
    --print("dist "..d, human.x, human.y-35, blue)
    --print("dist x "..x, human.x, human.y-17, blue)
    --print("dist y "..y, human.x, human.y-9, blue)
end


function box(obj)
    box_width,box_height = unpack(obj.box)
    return {obj.x, obj.y, obj.x+box_width, obj.y+box_height}
end

function draw_object_box(obj, color)
    _box = box(obj)
    _box[#_box+1] = color
    --rect(unpack(_box))
end

function distance(obj1, obj2)
    box1 = box(obj1)
    box2 = box(obj2)

    xdist = min(
        abs(box1[1] - box2[3]),
        abs(box1[3] - box2[1])
    )
    ydist = min(
        abs(box1[2] - box2[4]),
        abs(box1[4] - box2[2])
    )

    return {abs(xdist), abs(ydist)}
end

function ldistance(obj1, obj2)
    x,y = unpack(distance(obj1, obj2))

    return sqrt(2*x + 2*y)
end

function draw_ball()
    spr(33, ball.x, ball.y)
end

function dog_bark()
    if (stat(46) == -1) then
        sfx(0,0)
        dog.msg.t = 6
        dog.msg.txt = "woof"
    end
end

function can_move(x, y)
    if is_tile(non_walkable, x+8, y+8) then
        return false
    elseif is_tile(non_walkable, x, y+8) then
        return false
    elseif is_tile(non_walkable, x+8, y) then
        return false
    elseif is_tile(non_walkable, x, y) then
        return false				
    end

    return true
end

function move_dog()
    new_x,new_y = dog.x, dog.y
    
    if btn(fire1) then dog_bark() end
    if btn(left) then new_x -= 1 end
    if btn(right) then new_x += 1 end
    if btn(up) then new_y -= 1 end
    if btn(down) then new_y += 1 end

    if (dog.x != new_x) then
        dog.face_left = dog.x >= new_x
    end

    if can_move(new_x, new_y) then
        dog.x, dog.y = new_x, new_y
    end

    dog.love = ldistance(dog, human) <= 3
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000333333333333333333333333493333333333333300000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000033333333333d33333a333a33496633333333333300000000
007007000000000000000000000000000000000000000000000000000000000000000000000000003333333333333333a9a3a9a3493333333333333300000000
0007700000000000000000000000000000000000000000000000000000000000000000000000000033333333333333333abb3a33496633333333333300000000
000770000000000000000000000000000000000000000000000000000000000000000000000000003333333333333d33333bb333493333336363636300000000
007007000000000000000000000000000000000000000000000000000000000000000000000000003333333333d33333335b5333496633336363636300000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000333333333333333333555333493333339999999900000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000333333333333333333333333496633334444444400000000
00444400000000000044444000000000000000000000000000000000000000000000000000000000000000000000000000000000333366944444444400000000
00f6f6000000000004fffff000000000000000000000000000000000000000000000000000000000000000000000000000000000333333949999999900000000
00ffff000000000004ff5f5000000000000000000000000000000000000000000000000000000000000000000000000000000000333366946363636300000000
0f9999f00000000004fffff000000000000000000000000000000000000000000000000000000000000000000000000000000000333333946363636300000000
00999900000000000499000000000000000000000000000000000000000000000000000000000000000000000000000000000000333366943333333300000000
00cccc00000000000099900000000000000000000000000000000000000000000000000000000000000000000000000000000000333333943333333300000000
00c00c000000000000dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000333366943333333300000000
005505500000000000dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000333333943333333300000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000333366944933333300000000
44000044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000333333999966333300000000
44444444008880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000333363636333333300000000
04444440088898000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000333333636363333300000000
44444444088888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000333333333333333300000000
44000044008880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000333333333333333300000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000333333333333333300000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000333333333333333300000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000333333333333333300000000
00707000007070000070700000707000000000000000000000000000000000000000000000000000000000000000000000000000333333333333333300000000
00777000007770000077700000777000000000000000000000000000000000000000000000000000000000000000000000000000333333333333333300000000
07707000077070000777700007707000000000000000000000000000000000000000000000000000000000000000000000000000333333333333333300000000
07777000077770000777700007777007000000000000000000000000000000000000000000000000000000000000000000000000333363636333333300000000
00777777007777700077777700777770000000000000000000000000000000000000000000000000000000000000000000000000333333636363333300000000
00777770007777770077777000777770000000000000000000000000000000000000000000000000000000000000000000000000333366999933333300000000
00707070007070700070707000707070000000000000000000000000000000000000000000000000000000000000000000000000333333944966333300000000
0000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000bbbb0000bb0000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bbbbbbb0bbbbb00000007777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b3b33b3bb3b33bb0000077767770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b3331333b33333330000776666677700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33111313331113130007756657555770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31111111311111110077556557555770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111111110775565557765677000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000007755655555755666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000007555555555555556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005555555555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005555555555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005555555555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005555555555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005555555555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005555555555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000101000000000000000001010000000000000000000000000000010100000300000000000000000000000101000000000000000000000001000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000010100000000000000000000000000000101000003000000000000000000000001010000000000000000000000010000010100
__map__
3d0e0e0e0e0e0e0e0e0e0e0e0e0e0e3e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0a0a0a0a0a0a0a0a0a0a0a0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0a0a0a0a0b0a0a0a0a0a0c0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0b0a0a0a0a0a0a0a0a0c0a0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0a0a0a0a0a0a0a0a0a0a0a0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0a0a0a0a0a0a0a0a0a0a0a0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0a0a0a0a0a0a0a0a0a0a0a0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0a0a0a0a0a0a0a0a0a0a0a0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0a0a0a0b0a0a0a0a0a0b0a0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0a0a0a0a0a0a0a0a0a0a0a0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0a0a0a0a0a0a0a0a0a0a0a0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0a0a0a0a0a0a0a0a0a0b0a0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0a0a0b0a0a0a0a0a0a0a0a0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0a0c0a0a0a0a0a0a0a0a0a0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d0a0a0a0a0a0a0a0a0a0a0a0a0a0a0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2d1e1e1e1e1e1e1e1e1e1e1e1e1e1e2e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000300000f55011550115500e550035500f4001250015400207002070020700000001990019900199001a9001a9001c9002090022900249000000000000000000000000000000000000000000000000000000000
0003060002150031500415006150081500b1500c60034100031001610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
